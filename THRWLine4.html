<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta charset="UTF-8">
    <title>Tu Canasta</title>
    <link rel="stylesheet" href="style5.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script> 
    <script src="https://kit.fontawesome.com/b408879b64.js" crossorigin="anonymous"></script>
</head>
<body>

    <div class="header-area">
        <header>    
            <div class="menu container">
                <img class="logo-1" src="imagenes/logo 1.png" alt="">
                <input type="checkbox" id="menu" />
                <label for="menu">
                <img class="logo-2" src="imagenes/menu.png" alt="">
                </label>
                <a href="index.html">
                <img class="logo-2" src="imagenes/logo 2.png" alt="">
                </a>
                <nav class="navbar">
                    <div class="menu-1">
                        <ul>
                            <li><a href="THRWLine2.html">Lo mas nuevo</a></li>
                            <li><a href="#">Ofertas</a></li>
                            <li><a href="THRWLine2.html?categoria=Hombre">Hombre</a></li>
                            <li><a href="THRWLine2.html?categoria=Mujer">Mujer</a></li>

                        </ul>
                    </div>
                        <div class="buscador container">
                            <input type="text" id="searchInput" placeholder="Buscar...">
                            <button id="searchBtn"><i class="fa-solid fa-magnifying-glass"></i></button>
                        </div>

                
                    <div class="menu-2">
                        <div class="Redirecciones">
                        <a href="THRWLine3.html">
                            <img src="imagenes/inciarsesion.png" alt="">
                        </a>
                        <div class="carrito-icono">
                        <a href="THRWLine4.html" class="carrito-icono">
                            <img src="imagenes/bas.png" alt="">
                            <span id="carrito-contador">0</span>
                        </a>
                        </div>

                        </div>
                    </div>

                </nav>
                </div>
        </header>
    </div>

    
    <script>
        document.getElementById("searchBtn").addEventListener("click", () => {
            const texto = document.getElementById("searchInput").value.trim();

            if (texto !== "") {
                window.location.href = "THRWLine2.html?buscar=" + encodeURIComponent(texto);

            }
        });
        document.getElementById("searchInput").addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                document.getElementById("searchBtn").click();
            }
        });
        function actualizarCarritoIcono() {
            let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
            let total = carrito.reduce((acum, p) => acum + p.cantidad, 0);

            let icono = document.getElementById("carrito-contador");
            if (icono) icono.textContent = total;
        }

        // Llamar apenas cargue la pagina
        actualizarCarritoIcono();

    </script>
  
   <div class="canasta">
    <h1>TU CANASTA</h1>
    <div id="lista-productos"></div>
    <div id="resumen-final"></div>
         </div>

          <script>
    const listaProductos = document.getElementById("lista-productos");
    const resumenFinal = document.getElementById("resumen-final");

    

    function eliminarProducto(index) {
        let carrito = JSON.parse(localStorage.getItem('cestaProductos')) || [];
        
        if (index > -1 && index < carrito.length) {
           
            if (confirm("¿Estás seguro de que deseas eliminar este producto?")) {
                carrito.splice(index, 1);
                localStorage.setItem('cestaProductos', JSON.stringify(carrito));
                alert("Producto eliminado de la canasta.");
               
                mostrarCanasta(); 
            }
        }
    }
    
   
    function actualizarCantidad(index, inputElement) {
        let carrito = JSON.parse(localStorage.getItem('cestaProductos')) || [];
        
        const nuevaCantidad = parseInt(inputElement.value.replace(/[^0-9]/g, '')) || 1; 

        if (index > -1 && index < carrito.length) {
            carrito[index].cantidad = nuevaCantidad;
            localStorage.setItem('cestaProductos', JSON.stringify(carrito));
            
            mostrarCanasta(); 
        }
    }
    
    function vaciarCanasta() {
        if (confirm("¿Estás seguro de que deseas vaciar toda la canasta?")) {
            localStorage.removeItem('cestaProductos');
            mostrarCanasta();
            alert("Canasta vaciada correctamente.");
        }
    }

    function pagarAhora() {
        let usuario = localStorage.getItem("usuarioLogueado");
        
        let carrito = JSON.parse(localStorage.getItem("cestaProductos")) || [];
        localStorage.setItem("productosPago", JSON.stringify(carrito)); 

        if (usuario) {

            window.location.href = "THRWLine5.html";
        } else {

            alert("Debes iniciar sesion antes de pagar");
            window.location.href = "THRWLine3.html";
        }
    }

    function cambiarCantidad(index, cambio) {
    let carrito = JSON.parse(localStorage.getItem('cestaProductos')) || [];

    if (!carrito[index]) return;

    let nuevaCantidad = carrito[index].cantidad + cambio;

    if (nuevaCantidad < 1) nuevaCantidad = 1;

    carrito[index].cantidad = nuevaCantidad;
    localStorage.setItem('cestaProductos', JSON.stringify(carrito));

    mostrarCanasta(); 
}
   
    function mostrarCanasta() {
        const carrito = JSON.parse(localStorage.getItem('cestaProductos')) || [];
        listaProductos.innerHTML = "";
        resumenFinal.innerHTML = "";

        if (carrito.length === 0) {
            listaProductos.innerHTML = "<p>Tu canasta está vacía. ¡Explora nuestros productos y agrega algo!</p>";
            return;
        }

        let totalGeneral = 0;
        const COSTO_ENVIO = 100;
        const UMBRAL_ENVIO_GRATIS = 500;

        carrito.forEach((producto, index) => {
            let subtotalGeneral = 0;

            carrito.forEach((producto, index) => {
                const subtotal = producto.precio * producto.cantidad;
                subtotalGeneral += subtotal;

                const div = document.createElement("div");
                div.classList.add("producto");
                div.innerHTML = `
                    <img src="${producto.imagen}" alt="${producto.nombre}">
                    <div class="info">
                        <h2>${producto.nombre}</h2>
                        <p>Talla: ${producto.talla}</p>

                        <p>
                            Cantidad:
                            <span class="botones">
                                <button onclick="cambiarCantidad(${index}, -1)">−</button>

                                <input type="text" value="${producto.cantidad}" 
                                    class="cantidad"
                                    oninput="this.value = this.value.replace(/[^0-9]/g,'')"
                                    onchange="actualizarCantidad(${index}, this)">

                                <button onclick="cambiarCantidad(${index}, 1)">+</button>
                            </span>
                        </p>

                        <p>Llega el jueves 25 de septiembre</p>
                    </div>

                    <div class="resumen">
                        <p>Subtotal: $${subtotal.toFixed(2)}</p>

                        <button onclick="eliminarProducto(${index})"
                            style="background:black;color:white;border:none;padding:10px 20px;border-radius:5px;margin-top:10px;">
                            ELIMINAR
                        </button>
                    </div>
                `;
                listaProductos.appendChild(div);
            });

            const COSTO_ENVIO = 100;
            const UMBRAL_ENVIO_GRATIS = 500;

            let costoEnvioFinal = subtotalGeneral >= UMBRAL_ENVIO_GRATIS ? 0 : COSTO_ENVIO;
            let totalFinal = subtotalGeneral + costoEnvioFinal;

            resumenFinal.innerHTML = `
                <hr>
                <p style="text-align:right;">Subtotal general: $${subtotalGeneral.toFixed(2)} MXN</p>
                <p style="text-align:right;">Gastos de envio: $${costoEnvioFinal.toFixed(2)} MXN</p>
                <h3 style="text-align:right;font-weight:bold;">Total a pagar: $${totalFinal.toFixed(2)} MXN</h3>

                <div style="text-align:right; display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                    <button onclick="pagarAhora()" 
                        style="font-weight:bold;background:black;color:white;border:none;padding:10px 20px;border-radius:5px;">
                        PAGAR TODO
                    </button>

                    <button onclick="vaciarCanasta()" 
                        style="font-weight:bold;background:#f44336;color:white;border:none;padding:10px 20px;border-radius:5px;">
                        Vaciar Canasta
                    </button>
                </div>
            `;


            const div = document.createElement("div");
            div.classList.add("producto");
            div.innerHTML = `
            <img src="${producto.imagen}" alt="${producto.nombre}">
            <div class="info">
                <h2>${producto.nombre}</h2>
                <p>Talla: ${producto.talla}</p>
                <p>
                    Cantidad:
                    <span class="botones">
                        <button onclick="cambiarCantidad(${index}, -1)">−</button>

                        <input type="text" value="${producto.cantidad}" 
                            class="cantidad"
                            oninput="this.value = this.value.replace(/[^0-9]/g,'')"
                            onchange="actualizarCantidad(${index}, this)">

                        <button onclick="cambiarCantidad(${index}, 1)">+</button>
                    </span>
                </p>
                <p>Llega el jueves 25 de septiembre</p>
            </div>
            <div class="resumen">
                <p>Subtotal: $${subtotal.toFixed(2)}</p>
                <p>Gastos de envío: $${envio.toFixed(2)}</p>
                <p class="total">Total: $${total.toFixed(2)}</p>
                
                <button 
                    onclick="eliminarProducto(${index})" 
                    style="background-color: #000; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; margin-top: 10px;">
                    ELIMINAR
                </button>
            </div>
            `;
            listaProductos.appendChild(div);
        });

        
        resumenFinal.innerHTML = `
            <hr>
            <h3 style="text-align:right;">Total general: $${totalGeneral.toFixed(2)} MXN</h3>
            <div style="text-align:right; display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                <button 
                    onclick="pagarAhora()" 
                    style="font-weight: bold; background-color: #000; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px;">
                    PAGAR TODO
                </button>
                
                <button 
                    onclick="vaciarCanasta()" 
                    style="font-weight: bold; background-color: #f44336; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px;">
                    Vaciar Canasta
                </button>
            </div>
        `;
    }

    
    mostrarCanasta();
</script>
<script src="carrito.js"></script>

</body>
</html>
